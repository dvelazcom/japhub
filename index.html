<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Transcript Player</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }
        
        /* Video Side */
        .video-panel {
            flex: 6;
            display: flex;
            flex-direction: column;
            background: #000;
            padding: 20px;
        }
        
        #video-player {
            width: 100%;
            height: auto;
            max-height: 70vh;
            background: #000;
            border-radius: 8px;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* Transcript Side */
        .transcript-panel {
            flex: 4;
            background: #1c1c1e;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #38383a;
        }
        
        .transcript-header {
            padding: 20px;
            background: #2c2c2e;
            border-bottom: 1px solid #38383a;
        }
        
        .transcript-header h2 {
            font-size: 20px;
            margin-bottom: 8px;
        }
        
        .transcript-info {
            font-size: 14px;
            color: #98989d;
        }
        
        .transcript-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            scroll-behavior: smooth;
        }
        
        .transcript-item {
            padding: 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: text;
            -webkit-user-select: text;
        }
        
        .transcript-item:hover {
            background: #2c2c2e;
        }
        
        .transcript-item.active {
            background: #007AFF;
            color: #fff;
        }
        
        .transcript-item.past {
            opacity: 0.6;
        }
        
        .transcript-timestamp {
            font-size: 12px;
            color: #98989d;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .transcript-item.active .transcript-timestamp {
            color: rgba(255,255,255,0.8);
        }
        
        .transcript-text {
            font-size: 16px;
            line-height: 1.6;
        }
        
        /* Custom Scrollbar */
        .transcript-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .transcript-content::-webkit-scrollbar-track {
            background: #1c1c1e;
        }
        
        .transcript-content::-webkit-scrollbar-thumb {
            background: #48484a;
            border-radius: 4px;
        }
        
        .transcript-content::-webkit-scrollbar-thumb:hover {
            background: #58585a;
        }
        
        button {
            min-height: 44px;
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: #007AFF;
            color: white;
            cursor: pointer;
            font-weight: 500;
        }
        
        button:hover {
            background: #0051D5;
        }
        
        .subtitle-counter {
            font-size: 18px;
            font-weight: 600;
            padding: 12px 24px;
            background: #1c1c1e;
            border-radius: 8px;
            color: #fff;
        }
        
        /* Upload Screen */
        .upload-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .upload-container {
            background: #1c1c1e;
            padding: 40px;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
        }
        
        .upload-container h1 {
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .file-section {
            margin: 25px 0;
            padding: 20px;
            background: #2c2c2e;
            border-radius: 12px;
        }
        
        .file-section h3 {
            margin-bottom: 15px;
            color: #98989d;
            font-size: 16px;
        }
        
        .file-btn {
            width: 100%;
            margin: 10px 0;
            min-height: 50px;
        }
        
        .file-info {
            margin-top: 10px;
            padding: 12px;
            background: #007AFF;
            border-radius: 8px;
            font-size: 14px;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .video-panel {
                flex: 1;
            }
            
            .transcript-panel {
                flex: 1;
                border-left: none;
                border-top: 1px solid #38383a;
            }
        }
        
        :root {
            /* Primitive Color Tokens */
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-teal-800: rgba(41, 150, 161, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);

            /* RGB versions for opacity control */
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-red-400-rgb: 255, 84, 89;
            --color-orange-500-rgb: 168, 75, 47;
            --color-orange-400-rgb: 230, 129, 97;

            /* Background color tokens (Light Mode) */
            --color-bg-1: rgba(59, 130, 246, 0.08);
            --color-bg-2: rgba(245, 158, 11, 0.08);
            --color-bg-3: rgba(34, 197, 94, 0.08);
            --color-bg-4: rgba(239, 68, 68, 0.08);
            --color-bg-5: rgba(147, 51, 234, 0.08);
            --color-bg-6: rgba(249, 115, 22, 0.08);
            --color-bg-7: rgba(236, 72, 153, 0.08);
            --color-bg-8: rgba(6, 182, 212, 0.08);

            /* Semantic Color Tokens (Light Mode) */
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            --color-warning: var(--color-orange-500);
            --color-info: var(--color-slate-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
            --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

            /* Common style patterns */
            --focus-ring: 0 0 0 3px var(--color-focus-ring);
            --focus-outline: 2px solid var(--color-primary);
            --status-bg-opacity: 0.15;
            --status-border-opacity: 0.25;

            /* Typography */
            --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            --font-size-xs: 11px;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-md: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-size-4xl: 30px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;
            --line-height-tight: 1.2;
            --line-height-normal: 1.5;
            --letter-spacing-tight: -0.01em;

            /* Spacing */
            --space-0: 0;
            --space-1: 1px;
            --space-2: 2px;
            --space-4: 4px;
            --space-6: 6px;
            --space-8: 8px;
            --space-10: 10px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;

            /* Border Radius */
            --radius-sm: 6px;
            --radius-base: 8px;
            --radius-md: 10px;
            --radius-lg: 12px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
            --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);

            /* Animation */
            --duration-fast: 150ms;
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }




    </style>
</head>
<body>
    <!-- Upload Screen -->
    <div id="upload-screen" class="upload-screen">
        <div class="upload-container">
            <h1>üì∫ Video Transcript Player</h1>
            
            <div class="file-section">
                <h3>SELECT VIDEO FILE</h3>
                <button class="file-btn" id="select-video-btn">Choose Video</button>
                <input type="file" id="video-file-input" accept="video/*" style="display: none;">
                <div id="video-filename" class="file-info" style="display: none;"></div>
            </div>
            
            <div class="file-section">
                <h3>SELECT SUBTITLE FILE</h3>
                <button class="file-btn" id="select-subtitle-btn">Choose Subtitle</button>
                <input type="file" id="subtitle-file-input" accept="text/plain,.srt,.vtt,.txt,.ass,text/*,*/*" style="display: none;">
                <div id="subtitle-filename" class="file-info" style="display: none;"></div>
            </div>
            
            <button id="load-player-btn" class="file-btn" disabled style="background: #34C759; font-size: 18px;">
                ‚ñ∂Ô∏è Load Player
            </button>
        </div>
    </div>
    
    <!-- Player Screen -->
    <div id="player-screen" class="container" style="display: none;">
        <!-- Video Panel -->
        <div class="video-panel">
            <video id="video-player" controls></video>
            
            <div class="controls">
                <button id="prev-btn">‚¨ÖÔ∏è Previous</button>
                <span class="subtitle-counter" id="subtitle-counter">0 / 0</span>
                <button id="next-btn">Next ‚û°Ô∏è</button>
            </div>
        </div>
        
        <!-- Transcript Panel -->
        <div class="transcript-panel">
            <div class="transcript-header">
                <h2>Transcript</h2>
                <p class="transcript-info">Click any subtitle to jump to that timestamp ‚Ä¢ Select text for Manabi Reader</p>
            </div>
            
            <div id="transcript-content" class="transcript-content">
                <!-- Transcript items will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // State
        let videoFile = null;
        let subtitleFile = null;
        let subtitles = [];
        let currentIndex = 0;

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            attachEventListeners();
        });

        function attachEventListeners() {
            // File selection
            document.getElementById('select-video-btn').addEventListener('click', () => {
                document.getElementById('video-file-input').click();
            });
            
            document.getElementById('select-subtitle-btn').addEventListener('click', () => {
                document.getElementById('subtitle-file-input').click();
            });
            
            document.getElementById('video-file-input').addEventListener('change', handleVideoSelect);
            document.getElementById('subtitle-file-input').addEventListener('change', handleSubtitleSelect);
            document.getElementById('load-player-btn').addEventListener('click', loadPlayer);
            
            // Playback controls
            document.getElementById('prev-btn').addEventListener('click', previousSubtitle);
            document.getElementById('next-btn').addEventListener('click', nextSubtitle);
        }

        function handleVideoSelect(event) {
            const file = event.target.files[0];
            if (file) {
                videoFile = file;
                const info = document.getElementById('video-filename');
                info.textContent = `‚úì ${file.name}`;
                info.style.display = 'block';
                checkLoadButton();
            }
        }

        async function handleSubtitleSelect(event) {
            const file = event.target.files[0];
            if (file) {
                subtitleFile = file;
                const text = await file.text();
                subtitles = parseSRT(text);
                
                const info = document.getElementById('subtitle-filename');
                info.textContent = `‚úì ${file.name} (${subtitles.length} subtitles)`;
                info.style.display = 'block';
                
                checkLoadButton();
            }
        }

        function checkLoadButton() {
            const loadBtn = document.getElementById('load-player-btn');
            if (videoFile && subtitles.length > 0) {
                loadBtn.disabled = false;
            }
        }

        function parseSRT(text) {
            const blocks = text.trim().split(/\n\s*\n/);
            const parsed = [];
            
            blocks.forEach(block => {
                const lines = block.split('\n');
                if (lines.length >= 3) {
                    const timeMatch = lines[1].match(/(\d{2}):(\d{2}):(\d{2}),(\d{3})\s*-->\s*(\d{2}):(\d{2}):(\d{2}),(\d{3})/);
                    if (timeMatch) {
                        const startTime = parseTimestamp(timeMatch[1], timeMatch[2], timeMatch[3], timeMatch[4]);
                        const endTime = parseTimestamp(timeMatch[5], timeMatch[6], timeMatch[7], timeMatch[8]);
                        const text = lines.slice(2).join(' ').trim();
                        
                        parsed.push({
                            start: startTime,
                            end: endTime,
                            text: text,
                            timestamp: formatTimestamp(startTime)
                        });
                    }
                }
            });
            
            return parsed;
        }

        function parseTimestamp(hours, minutes, seconds, milliseconds) {
            return (parseInt(hours) * 3600) + (parseInt(minutes) * 60) + parseInt(seconds) + (parseInt(milliseconds) / 1000);
        }

        function formatTimestamp(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            if (hrs > 0) {
                return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function loadPlayer() {
            // Hide upload screen, show player
            document.getElementById('upload-screen').style.display = 'none';
            document.getElementById('player-screen').style.display = 'flex';
            
            // Load video
            const video = document.getElementById('video-player');
            video.src = URL.createObjectURL(videoFile);
            
            // Build transcript
            buildTranscript();
            
            // Setup video time update listener
            video.addEventListener('timeupdate', handleVideoTimeUpdate);
            
            // Start at first subtitle
            currentIndex = 0;
            updateActiveSubtitle();
        }

        function buildTranscript() {
            const container = document.getElementById('transcript-content');
            container.innerHTML = '';
            
            subtitles.forEach((subtitle, index) => {
                const item = document.createElement('div');
                item.className = 'transcript-item';
                item.dataset.index = index;
                
                const timestamp = document.createElement('div');
                timestamp.className = 'transcript-timestamp';
                timestamp.textContent = subtitle.timestamp;
                
                const text = document.createElement('div');
                text.className = 'transcript-text';
                text.textContent = subtitle.text;
                
                item.appendChild(timestamp);
                item.appendChild(text);
                
                // Click to jump to timestamp
                item.addEventListener('click', () => {
                    jumpToSubtitle(index);
                });
                
                container.appendChild(item);
            });
        }

        function handleVideoTimeUpdate() {
            const video = document.getElementById('video-player');
            const currentTime = video.currentTime;
            
            // Find current subtitle based on video time
            for (let i = 0; i < subtitles.length; i++) {
                if (currentTime >= subtitles[i].start && currentTime < subtitles[i].end) {
                    if (i !== currentIndex) {
                        currentIndex = i;
                        updateActiveSubtitle();
                    }
                    break;
                }
            }
        }

        function updateActiveSubtitle() {
            // Update counter
            document.getElementById('subtitle-counter').textContent = `${currentIndex + 1} / ${subtitles.length}`;
            
            // Update transcript highlighting
            const items = document.querySelectorAll('.transcript-item');
            items.forEach((item, index) => {
                item.classList.remove('active', 'past');
                
                if (index === currentIndex) {
                    item.classList.add('active');
                    // Scroll to active item
                    item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else if (index < currentIndex) {
                    item.classList.add('past');
                }
            });
        }

        function jumpToSubtitle(index) {
            const video = document.getElementById('video-player');
            video.currentTime = subtitles[index].start;
            currentIndex = index;
            updateActiveSubtitle();
        }

        function previousSubtitle() {
            if (currentIndex > 0) {
                jumpToSubtitle(currentIndex - 1);
            }
        }

        function nextSubtitle() {
            if (currentIndex < subtitles.length - 1) {
                jumpToSubtitle(currentIndex + 1);
            }
        }


    </script>
</body>
</html>
